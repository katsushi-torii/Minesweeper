<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minesweeper</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
</head>
<body>
    <main>
        <article>
            <h1>Number of bombs:</h1>
            <h1 class="bombNumber"></h1>
        </article>
        <blockquote>
            <p>Left click to open numbers.</p>
            <p>Right click to spot bombs.</p>
        </blockquote>
        <table class="field" oncontextmenu="return false";>
        </table>
    </main>
</body>
<script>
    const alphabet = ["A", "B", "C", "D", "E", "F", "G", "H", "I"];
    const field = [];
    let bombRate = 16;
    for(let i = 0; i < 9; i++){
        field[i] = new Array;
    }
    class Square {
        //ãƒã‚¹ç›®ã®åå‰ã€çˆ†å¼¾ã®æœ‰ç„¡ã€å‘¨ã‚Šã®çˆ†å¼¾ã®æ•°
        constructor(name, bomb, number){
            this.name = name;
            this.bomb = bomb;
            this.number = number;
        }
    }
    let num = 0;
    for(let i = 0; i < 9; i++){
        for(let j = 0; j < 9; j++){
            let bombBooleon = Math.floor(Math.random() * 100);
            //ä¸€å®šã®ç¢ºç‡(bombRate)ã‚ˆã‚Šä½ã‹ã£ãŸã‚‰çˆ†å¼¾ã«è¨­å®šã™ã‚‹ã€çˆ†å¼¾ã®æ•°ã¯å¾Œã§è¨­å®š
            if(bombBooleon <= bombRate){
                field[i][j] = new Square(alphabet[i] + num, true, 0);
            }else{
                field[i][j] = new Square(alphabet[i] + num, false, 0);
            }
            num += 1;
        }
        num = 0;
    }
    for(let i = 0; i< 9; i++){
        for(let j = 0; j < 9; j++){
            let aroundBomb = 0;
            //å·¦ã®ãƒã‚¹ãŒçˆ†å¼¾ã‹ã©ã†ã‹
            if(j !== 0 && field[i][j-1].bomb == true){
                aroundBomb += 1;
            }
            //å³
            if(j !== 8 && field[i][j+1].bomb == true){
                aroundBomb += 1;
            }
            //ä¸Š
            if(i !== 0 && field[i-1][j].bomb == true){
                aroundBomb += 1;
            }
            //ä¸‹
            if(i !== 8 && field[i+1][j].bomb == true){
                aroundBomb += 1;
            }
            //å·¦ä¸Š
            if(i !== 0 && j !== 0 && field[i-1][j-1].bomb == true){
                aroundBomb += 1;
            }
            //å³ä¸Š
            if(i !== 0 && j !== 8 && field[i-1][j+1].bomb == true){
                aroundBomb += 1;
            }
            //å·¦ä¸‹
            if(i !== 8 && j !== 0 && field[i+1][j-1].bomb == true){
                aroundBomb += 1;
            }
            //å·¦ä¸‹
            if(i !== 8 && j !== 8 && field[i+1][j+1].bomb == true){
                aroundBomb += 1;
            }
            field[i][j].number = aroundBomb;
        }
    }
    let bombTotal = 0;
    for(let i = 0; i < 9; i++){
        let div = $(`<div></div>`);
        for(let j = 0; j < 9; j++){
            if(field[i][j].bomb == true){
                let span = $(`<button>ğŸ’£</button>`);
                div.append(span);
                bombTotal += 1;
            // }else if(field[i][j].number == 0){
            //     let span = $(`<button></button>`);
            //     div.append(span);
            }else{
                let span = $(`<button>${field[i][j].number}</button>`);
                div.append(span);
            }
        }
        $('.field').append(div);
    }
    //ç”»é¢ä¸Šã«çˆ†å¼¾æ•°ã‚’è¡¨ç¤º
    $('.bombNumber').html(bombTotal);
    let bombCount = 0;
    let flagCount = 0;
    $('.field button').click((e)=>{
        e.target.classList.add('clicked');
        bombCount += 1;
        //çˆ†å¼¾ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼
        if(e.target.innerHTML == 'ğŸ’£'){
            $('.field button').addClass('clicked');
            alert('GAME OVER');
        } 
        //é–‹ã‘ãŸç•ªå·ã®ãƒã‚¹æ•°ã¨èµ¤ãƒã‚¹ã®åˆè¨ˆãŒ82ãƒã‚¹ã¨ç­‰ã—ã„å ´åˆã€ã‚¯ãƒªã‚¢
        if(bombCount + flagCount == 81){
            alert("CLEAR!");
            $('.field button').addClass('clicked');
        }
    })
    $('.field button').contextmenu((e)=>{
        //é–‹ã‘ãŸç•ªå·ã‚’èµ¤ãƒã‚¹ã«ã—ãªã„ã‚ˆã†ã«ï¼ˆã‚¯ãƒªã‚¢æ¡ä»¶ã‚’ä¹±ã•ãªã„ã‚ˆã†ã«ï¼‰
        if(e.target.classList[0] !== 'clicked'){
            e.target.classList.toggle('flag');
        }
        //flagã‚¯ãƒ©ã‚¹ã‚’æŒã£ã¦ã„ãªã„ãƒã‚¹ï¼èµ¤ããªã„ãƒã‚¹ã€æŒã£ã¦ã„ã‚‹ï¼èµ¤ã„
        if(e.target.classList[0] == 'flag' || e.target.classList[1] == 'flag'){
            flagCount += 1;
        }else{
            flagCount -= 1;
        }
        //é–‹ã‘ãŸç•ªå·ã®ãƒã‚¹æ•°ã¨èµ¤ãƒã‚¹ã®åˆè¨ˆãŒ82ãƒã‚¹ã¨ç­‰ã—ã„å ´åˆã€ã‚¯ãƒªã‚¢
        if(bombCount + flagCount == 81){
            alert("CLEAR!");
            $('.field button').addClass('clicked');
        }
    })
</script>
</html>